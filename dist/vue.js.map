{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/utils.js","../src/observe/index.js","../src/state.js","../src/compiler/generate.js","../src/compiler/parser.js","../src/compiler/index.js","../src/lifecycle.js","../src/init.js","../src/vdom/index.js","../src/render.js","../src/index.js"],"sourcesContent":["let oldArrayPrototype = Array.prototype // 获取数组的老的原型方法\n\n\n// 让arrayMethods 通过__proto__ 能获取到数组的方法\n// arrayMethods 通过__proto__ 能获取到数组的方法\n// arrayMethods.__proto__ == oldArrayPrototype\n// arrayMethods.push = function\nexport let arrayMethods = Object.create(oldArrayPrototype)\n\nlet methods = [ // 只有这七个方法 可以导致数组发生变化\n  'push',\n  'shift',\n  'pop',\n  'unshift',\n  'reverse',\n  'sort',\n  'splice'\n]\n\nmethods.forEach((method)=>{\n  arrayMethods[method] = function(...args) {\n    // 数组新增的属性 要看一下是不是对象，如果是对象 继续进行劫持\n    // 需要调用数组原生逻辑\n    oldArrayPrototype[method].call(this, ...args)\n    // todo... 可以添加自己逻辑 函数劫持 切片\n    let inserted = null\n    let ob = this.__ob__\n    switch (method) {\n      case 'splice':// 修改 删除  添加  arr.splice(0,0,100,200,300)\n        inserted = args.slice(2) // splice方法从第三个参数起 是增添的新数据\n        break;\n      case 'push':\n      case 'unshift':\n        inserted = args // 调用push 和 unshift 传递的参数就是新增的逻辑\n        break\n      default:\n        break;\n    }\n    // inserted[] 遍历数组 看一下它是否需要进行劫持\n    if (inserted) ob.observeArray(inserted)\n  }\n})","export function isFunction(val){\n  return typeof val == 'function'\n}\nexport function isObject(val){\n  return typeof val == 'object' && val !== null;\n}\nexport let isArray = Array.isArray","import { arrayMethods } from \"./array\";\nimport { isArray, isObject } from \"../utils\";\n\nclass Observer {\n  constructor(value) {\n    // 不让__ob__ 被遍历到\n    // value.__ob__ = this; // 我给对象和数组添加一个自定义属性\n    Object.defineProperty(value, '__ob__', {\n      value: this,\n      enumerable: false, // 标识这个属性不能被列举出来，不能被循环到\n    })\n    if (isArray(value)) {\n      // 更改数组原型方法, 如果是数组 就改写数组的原型链\n      value.__proto__ = arrayMethods // 重写数组的方法\n      this.observeArray(value)\n    }else {\n      this.walk(value)\n    }\n  }\n\n  observeArray(data) { // 对数组内部的数组再次重写/对象（引用类型）\n    data.forEach((item)=>observe(item))\n  }\n\n  walk(data) {\n    Object.keys(data).forEach((key)=>{\n      defineReactive(data, key, data[key])\n    })\n\n  }\n}\n// vue2 应用了defineProperty需要一加载的时候 就进行递归操作，所以好性能，如果层次过深也会浪费性能\n// 1.性能优化的原则：\n// 1) 不要把所有的数据都放在data中，因为所有的数据都会增加get和set\n// 2) 不要写数据的时候 层次过深， 尽量扁平化数据 \n// 3) 不要频繁获取数据\n// 4) 如果数据不需要响应式 可以使用Object.freeze 冻结属性 \nfunction defineReactive(obj, key, value) { // vue2 慢的原因 主要在这个方法中\n  observe(value) // 递归进行观测数据，不管有多少层 我都进行\n  Object.defineProperty(obj, key, {\n    get() {\n      return value // 闭包，次此value 会像上层的value进行查找\n    },\n    set(newValue) { // 如果设置的是一个对象那么会再次进行劫持\n      if (newValue === value) return\n      observe(newValue)\n      console.log('修改')\n      value = newValue\n    }\n  })\n\n}\n\nexport function observe(value) {\n  if (!isObject(value)) return\n  if (value.__ob__) return // 一个对象不需要重新被观测\n\n  // 需要对对象进行观测 （最外层必须是一个{} 不能是数组）\n\n  // 如果一个数据已经被观测过了 ，就不要在进行观测了， 用类来实现，我观测过就增加一个标识 说明观测过了，在观测的时候 可以先检测是否观测过，如果观测过了就跳过检测\n  return new Observer(value)\n}","import { observe } from \"./observe\"; // rollup-plugin-node-resolve\nimport { isFunction } from \"./utils\";\n\nexport function initState(vm){\n    const opts = vm.$options;\n\n    if(opts.data){\n        initData(vm);\n    }\n\n}\nfunction proxy(vm,key,source){ // 取值的时候做代理，不是暴力的把_data 属性赋予给vm, 而且直接赋值会有命名冲突问题\n    Object.defineProperty(vm,key,{\n        get(){ // ?\n            return vm[source][key]; // vm._data.message \n        },\n        set(newValue){ // ?\n            vm[source][key] = newValue; // vm._data.message = newValue\n        }\n    })\n}\nfunction initData(vm){\n    let data = vm.$options.data; // 用户传入的数据\n\n    // 如果用户传递的是一个函数 则取函数的返回值作为对象 ， 如果就是对象那就直接使用这个对象\n    // 只有根实例可以data是一个对象\n\n    // data 和 vm._data 引用的是同一个人 -》 data被劫持了  vm._data也被劫持\n    data = vm._data =  isFunction(data) ? data.call(vm) : data; // _data 已经是响应式的了\n\n    // 需要将data变成响应式的 Object.defineProperty， 重写data中的所有属性\n    observe(data); // 观测对象中的属性\n\n\n\n    for(let key in data){ // vm.message => vm._data.message\n        proxy(vm,key,'_data');// 代理vm上的取值和设置值 和  vm._data 没关系了\n    }\n}\n","const defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // {{   xxx  }}\n\n\nfunction genProps(attrs) {\n  // {key:value,key:value,}\n  let str = '';\n  for (let i = 0; i < attrs.length; i++) {\n      let attr = attrs[i];\n      if (attr.name === 'style') { // {name:id,value:'app'}\n          let styles = {}\n          attr.value.replace(/([^;:]+):([^;:]+)/g, function() {\n              styles[arguments[1]] = arguments[2];\n          })\n          attr.value = styles\n      }\n      str += `${attr.name}:${JSON.stringify(attr.value)},`\n  }\n  return `{${str.slice(0,-1)}}`\n}\n\nfunction gen(el) {\n  if (el.type == 1) {\n      return generate(el); // 如果是元素就递归的生成\n  } else {\n      let text = el.text; // {{}}\n      if (!defaultTagRE.test(text)) return `_v('${text}')`; // 说明就是普通文本\n\n      // 说明有表达式 我需要 做一个表达式和普通值的拼接 ['aaaa',_s(name),'bbb'].join('+)\n      // _v('aaaa'+_s(name) + 'bbb')\n      let lastIndex = defaultTagRE.lastIndex = 0;\n      let tokens = []; // <div> aaa{{bbb}} aaa </div>\n      let match;\n\n      // ，每次匹配的时候 lastIndex 会自动向后移动\n      while (match = defaultTagRE.exec(text)) { // 如果正则 + g 配合exec 就会有一个问题 lastIndex的问题\n          let index = match.index;\n          if(index > lastIndex){\n              tokens.push(JSON.stringify(text.slice(lastIndex,index)));\n          }\n          tokens.push(`_s(${match[1].trim()})`);\n          lastIndex = index + match[0].length;\n      }\n      if(lastIndex < text.length){\n          tokens.push(JSON.stringify(text.slice(lastIndex)));\n      }\n      return `_v(${tokens.join('+')})`; // webpack 源码 css-loader  图片处理\n  }\n}\n\nfunction genChildren(el) {\n  let children = el.children;\n  if (children) {\n      return children.map(item => gen(item)).join(',')\n  }\n  return false;\n}\n\n// _c(div,{},c1,c2,c3,c4)\nexport function generate(ast) {\n  let children = genChildren(ast)\n  let code = `_c('${ast.tag}',${\n      ast.attrs.length?genProps(ast.attrs) :'undefined'\n  }${\n      children? `,${children}` :''\n  })`\n  return code;\n}\n","const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // 匹配标签名的  aa-xxx\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; //  aa:aa-xxx  \nconst startTagOpen = new RegExp(`^<${qnameCapture}`); //  此正则可以匹配到标签名 匹配到结果的第一个(索引第一个) [1]\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>  [1]\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的\n\n// [1]属性的key   [3] || [4] ||[5] 属性的值  a=1  a='1'  a=\"\"\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的  />    > \nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // {{   xxx  }}  \n\n// vue3的编译原理比vue2里好很多，没有这么多正则了\nexport function parserHTML(html) {\n   // 可以不停的截取模板，直到把模板全部解析完毕 \n  let stack = []\n  let root = null\n\n  // 要构建父子关系  \n  function createASTElement(tag, attrs, parent = null) {\n    return {\n      tag,\n      type: 1, // 元素\n      children: [],\n      parent,\n      attrs,\n    }\n\n  }\n\n  function start(tag, attrs) { // [div,p]\n    // 遇到开始标签 就取栈中的最后一个作为父节点\n    let parent = stack[stack.length - 1]\n    let element = createASTElement(tag, attrs, parent)\n    if (root == null) { // 说明当前节点就是根节点\n      root = element\n    }\n    if (parent) {\n      element.parent = parent // 跟新p的parent属性 指向parent\n      parent.children.push(element)\n    }\n    stack.push(element)\n  }\n\n  function end(tagName){\n    let endTag = stack.pop()\n    if (endTag.tag != tagName) {\n      console.log('标签出错')\n    }\n  }\n\n  function text(chars) {\n    let parent = stack[stack.length - 1]\n    chars = chars.replace(/\\s/g, \"\")\n    if (chars) {\n      parent.children.push({\n        type: 2,\n        text: chars\n      })\n    }\n  }\n\n  function advance(len) {\n    html = html.substring(len)\n  }\n\n  function parseStartTag() {\n    const start = html.match(startTagOpen)\n    if(start) {\n      const match = {\n        tagName: start[1],\n        attrs: [],\n      }\n      advance(start[0].length)\n      let end;\n      let attr;\n      while(!(end = html.match(startTagClose))&&(attr = html.match(attribute))) {// 1要有属性 2，不能为开始的结束标签 <div>\n        match.attrs.push({name: attr[1], value: attr[3] || attr[4] || attr[5]})\n        advance(attr[0].length)\n      }// <div id=\"app\" a=1 b=2 >\n      if(end) {\n        advance(end[0].length)\n      }\n      return match\n    }\n    return false\n  }\n\n  while(html) {\n    // 解析标签和文本   \n    let index = html.indexOf('<')\n    if(index == 0) {\n      // 解析开始标签 并且把属性也解析出来  </div>\n      const startTagMatch = parseStartTag()\n      if(startTagMatch) { // 开始标签\n        start(startTagMatch.tagName, startTagMatch.attrs)\n        continue\n      }\n      let endTagMatch\n      if (endTagMatch = html.match(endTag)) { // 结束标签\n        end(endTagMatch[1])\n        advance(endTagMatch[0].length)\n        continue\n      }\n    }\n    // 文本\n    if (index > 0) {\n      let chars = html.substring(0, index) //<div></div>\n      text(chars)\n      advance(chars.length)\n    }\n  }\n  return root\n\n}\n\n//  <div id=\"app\">hello wolrd <span>hello</span></div> */}","import { generate } from \"./generate\";\nimport { parserHTML } from \"./parser\";\n\n\nexport function compileToFunction(template) {\n\n    // 1.将模板变成ast语法树\n    let ast = parserHTML(template);\n\n    // 代码优化 标记静态节点\n\n    // 2.代码生成\n    let code = generate(ast);  // 模板引擎的实现原理 都是 new Function + with  ejs jade handlerbar...\n    let render = new Function(`with(this){return ${code}}`);\n\n    return render;\n    // 1.编译原理\n    // 2.响应式原理 依赖收集\n    // 3.组件化开发 （贯穿了vue的流程）\n    // 4.diff算法 \n}\n\n","export function mountComponent(vm) {\n  \n  vm._render() // _c _v _s\n}","import { initState } from \"./state\"\nimport { compileToFunction } from \"./compiler/index.js\"\nimport { mountComponent } from \"./lifecycle\"\n\nexport function initMixin(Vue) {\n  // 后续组件化开发的时候  Vue.extend 可以创造一个子组件，子组件可以继承Vue，子组件也可以调用_init方法\n  Vue.prototype._init = function(options) {\n    const vm = this\n    // 把用户的选项放到 vm上，这样在其他方法中都可以获取到options 了 \n    vm.$options = options // 为了后续扩展的方法 都可以获取$options选项\n    // options中是用户传入的数据 el , data\n    initState(vm)\n    if (vm.$options.el) {\n      // 要将数据挂载到页面上\n      // 现在数据已经被劫持了， 数据变化需要更新视图 diff算法更新需要更新的部分 \n      // vue -> template（写起来更符合直觉） -> jsx （灵活）\n      // vue3 template 写起来性能会更高一些 内部做了很多优化\n\n      // template -> ast语法树（用来描述语法的，描述语法本身的） -> 描述成一个树结构 ->  将代码重组成js语法\n      // 模板编译原理 （把template模板编译成render函数-》 虚拟DOM -》 diff算法比对虚拟DOM）\n      // ast -> render返回 -> vnode -> 生成真实dom \n      //      更新的时候再次调用render -> 新的vnode  -> 新旧比对 -> 更新真实dom\n      vm.$mount(vm.$options.el)\n    }\n  }\n\n   // new Vue({el}) new Vue().$mount\n  Vue.prototype.$mount = function(el) {\n    const vm = this\n    const opts = vm.$options\n    el = document.querySelector(el) // 获取真实的元素\n    vm.$el = el // 页面真实元素\n\n    // 先找render，没有找template，然后再看模版 el：#app\n\n    if (!opts.render) {\n      // 模板编译\n      let template = opts.template\n      debugger\n      if (!template) {\n        template = el.outerHTML\n      }\n\n      let render = compileToFunction(template)\n      opts.render = render // 最后都会生成render函数 更新时调用对比\n\n      \n    }\n\n    //  这里已经获取到了，一个render函数的了，这个函数它的返回值 _c('div',{id:'app'},_c('span',undefined,'hello'))\n    mountComponent(vm)\n\n  }\n}","export function createElement(vm, tag, data={},...children) { // 返回虚拟节点\n  return vnode(vm, tag, data, children, data, data.key, undefined)\n}\n\nexport function createText(vm, text) { // 返回虚拟节点\n  return vnode(vm, undefined, undefined, undefined, undefined, undefined, text)\n}\n\n\nfunction vnode(vm, tag, data, children, key, text) {\n  return {\n    vm, tag, data, children, key, text,\n  }\n}\n\n// vnode 其实就是一个对象 用来描述节点的  这个和ast长的很像？\n\n// ast 描述语法的  他并没有用户自己的逻辑 , 只有语法解析出来的内容\n\n// vnode 他是描述dom结构的 可以自己去扩展属性","import { isObject } from \"./utils\"\nimport {createElement, createText} from './vdom'\n\nexport function  renderMixin(Vue) {\n  Vue.prototype._c = function () { // craeteElement 创建元素型的节点\n    console.log(arguments)\n    const vm = this\n    return createElement(vm, ...arguments)\n  }\n\n  Vue.prototype._v = function (text) { // 创建文本型的节点\n    console.log(text)\n    console.log(arguments)\n    const vm = this\n    return createText(vm, text) // 描述虚拟节点是属于哪个实例的\n  }\n\n  Vue.prototype._s = function (val) { // stringify()\n    console.log(arguments)\n    if (isObject(val)) return JSON.stringify(val)\n    return val\n  }\n  Vue.prototype._render = function() {\n    const vm = this // vm中有所有的数据 vm.xxx vm._data.xxx\n    let { render} = vm.$options\n    debugger\n    let vnode = render.call(vm)\n    console.log(vnode)\n  }\n}","import { initMixin } from \"./init\"\nimport {renderMixin } from './render'\n\n// vue 要如何实现，原型模式，所有的功能都通过原型扩展的方式来添加\nfunction Vue(options) {\n  this._init(options) // 实现vue的初始化功能\n\n}\ninitMixin(Vue)\n\nrenderMixin(Vue)\n\nexport default Vue\n\n// 1.new Vue 会调用_init方法进行初始化操作\n// 2.会将用户的选项放到 vm.$options上\n// 3.会对当前属性上搜素有没有data 数据   initState\n// 4.有data 判断data是不是一个函数 ，如果是函数取返回值 initData\n// 5.observe 去观测data中的数据 和 vm没关系，说明data已经变成了响应式\n// 6.vm上像取值也能取到data中的数据 vm._data = data 这样用户能取到data了  vm._data\n// 7.用户觉得有点麻烦 vm.xxx => vm._data\n// 8.如果更新对象不存在的属性，会导致视图不更新， 如果是数组更新索引和长度不会触发更新\n// 9.如果是替换成一个新对象，新对象会被进行劫持，如果是数组存放新内容 push unshift() 新增的内容也会被劫持\n// 通过__ob__ 进行标识这个对象被监控过  （在vue中被监控的对象身上都有一个__ob__ 这个属性）\n// 10如果你就想改索引 可以使用$set方法 内部就是splice()\n\n\n\n// 如果有el 需要挂载到页面上"],"names":["oldArrayPrototype","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","call","inserted","ob","__ob__","slice","observeArray","isFunction","val","isObject","isArray","Observer","constructor","value","defineProperty","enumerable","__proto__","walk","data","item","observe","keys","key","defineReactive","obj","get","set","newValue","console","log","initState","vm","opts","$options","initData","proxy","source","_data","defaultTagRE","genProps","attrs","str","i","length","attr","name","styles","replace","arguments","JSON","stringify","gen","el","type","generate","text","test","lastIndex","tokens","match","exec","index","push","trim","join","genChildren","children","map","ast","code","tag","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parserHTML","html","stack","root","createASTElement","parent","start","element","end","tagName","pop","chars","advance","len","substring","parseStartTag","indexOf","startTagMatch","endTagMatch","compileToFunction","template","render","Function","mountComponent","_render","initMixin","Vue","_init","options","$mount","document","querySelector","$el","outerHTML","createElement","vnode","createText","undefined","renderMixin","_c","_v","_s"],"mappings":"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"}